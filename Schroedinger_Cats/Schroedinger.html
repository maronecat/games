<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <!-- スマホ・タブレットの画面幅に対応させるための記述 -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>シュレディンガー・キャッツ</title>
  <style>
    /* --- ふんわりパステル調の背景＆軽い装飾 --- */
    body {
      margin: 0;
      padding: 20px;
      font-family: "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif;
      background: linear-gradient(120deg, #ffe2e2 0%, #7ad5ff 100%);
      text-align: center;
    }
    h1 {
      color: #635155;
      text-shadow: 1px 1px 2px #fff;
      margin: 10px 0;
    }

    /* --- ステータス表示エリア --- */
    #status {
      margin: 10px auto;
      font-size: 18px;
      max-width: 600px;
      padding: 10px;
      background-color: #fff6f9;
      border-radius: 8px;
      box-shadow: 1px 1px 6px rgba(0,0,0,0.1);
    }
    #status span {
      color: #c64561;
      font-weight: bold;
    }

    /* --- ヒント表示エリア --- */
    #hints {
      margin: 10px auto;
      max-width: 600px;
      font-size: 16px;
      background-color: #fff;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 1px 1px 6px rgba(0,0,0,0.1);
    }
    #rowHints, #colHints {
      margin: 5px 0;
      color: #635155;
    }

    /* 
      --- パズルと猫を並べるコンテナ ---
      display: flex; gap: 20px; で横並び。
      画面幅が狭い時は縦配置になるようにflex-wrapで調整
    */
    #puzzleContainer {
      display: flex;
      flex-wrap: wrap;
      align-items: flex-start;
      justify-content: center;
      margin: 20px auto;
      gap: 20px;
      max-width: 900px; /* 余裕をもたせる */
    }

    /* --- ゲーム盤（テーブル） --- */
    table {
      border-collapse: collapse;
      box-shadow: 2px 2px 10px rgba(0,0,0,0.15);
      margin: 0 auto; /* スマホで縦配置された際も中央揃え */
    }
    td {
      width: 50px;
      height: 50px;
      border: 2px solid #f9bccd;
      background-color: #fff;
      font-size: 26px;
      text-align: center;
      vertical-align: middle;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.2s;
    }
    td:hover {
      background-color: #ffebf2;
    }

    /* --- リスタートボタン --- */
    #restartBtn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
      border: none;
      border-radius: 8px;
      background-color: #f4a4bb;
      color: #fff;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.1);
      transition: background-color 0.3s;
      display: none;
    }
    #restartBtn:hover {
      background-color: #e07e96;
    }

    /* --- 猫画像の基本スタイル (サイズはお好みで調整) --- */
    #cuteCat {
      width: 120px;        /* 猫の画像サイズ */
      margin-top: 10px;
      cursor: pointer;     /* クリックできる感じを出す */
    }

    /* --- ゆらゆらダンスのアニメーション(keyframes) --- */
    @keyframes catDance {
      0%   { transform: rotate(0deg)   scale(1);   }
      25%  { transform: rotate(-5deg)  scale(1.2); }
      50%  { transform: rotate(5deg)   scale(0.8); }
      75%  { transform: rotate(-5deg)  scale(1.1); }
      100% { transform: rotate(0deg)   scale(1);   }
    }

    /* --- クリック時にポヨンと弾むアニメーション(keyframes) --- */
    @keyframes catPoyon {
      0%   { transform: scale(1); }
      50%  { transform: scale(1.5); }
      100% { transform: scale(1); }
    }

    /* --- ゆらゆらダンスを無限に続けるクラス --- */
    .catDance {
      animation: catDance 2s ease-in-out infinite;
      display: block;
    }

    /* --- クリックされてポヨンするクラス(一時的) --- */
    .poyon {
      animation: catPoyon 0.3s ease-in-out forwards;
    }

    /* --- 説明文は下部に配置 --- */
    #explanation {
      margin: 30px auto 0 auto;
      max-width: 600px;
      background-color: rgba(255,255,255,0.8);
      border-radius: 8px;
      padding: 15px;
      font-size: 14px;
      color: #444;
      line-height: 1.6;
      box-shadow: 1px 1px 6px rgba(0,0,0,0.1);
      text-align: left;
    }
    #explanation h2 {
      margin-top: 0;
    }

    /* --- スマホ向けにサイズを調整(600px以下) --- */
    @media (max-width: 600px) {
      body {
        padding: 10px;
      }
      h1 {
        font-size: 22px;
      }
      #status, #hints {
        font-size: 14px;
        width: 90%;
      }
      table td {
        width: 40px;
        height: 40px;
        font-size: 20px;
      }
      #restartBtn {
        font-size: 16px;
      }
      #explanation {
        font-size: 12px;
        width: 90%;
      }
      #cuteCat {
        width: 100px; /* スマホ表示時にやや小さく */
        margin: 0 auto;
        display: block;
        /* スマホ時には、猫アイコンが上に回り込んでしまうので
           orderを変更して先頭に持ってくるなど好みで調整OK */
        order: -1;
      }
    }
  </style>
</head>
<body>
  <!-- タイトル -->
  <h1>シュレディンガー❤️キャッツ</h1>

  <!-- ステータス表示 -->
  <div id="status">
    スコア: <span id="score">0</span> /
    ライフ: <span id="lives">3</span>
  </div>

  <!-- ヒント表示 -->
  <div id="hints">
    <p id="rowHints"></p>
    <p id="colHints"></p>
  </div>

  <!-- パズルと猫を横並び表示するコンテナ -->
  <div id="puzzleContainer">
    <!-- 猫画像：初期状態で「catDance」クラスを付けて揺れアニメ開始 -->
    <img src="cat.PNG" id="cuteCat" alt="Cute Cat" class="catDance">
  </div>
    <!-- ゲーム盤 -->
    <table id="gameTable"></table>


  <!-- リスタートボタン -->
  <button id="restartBtn">もういっかいやるにゃ</button>

  <!-- ゲームロジックのスクリプト -->
  <script>
    const table = document.getElementById("gameTable");
    const scoreSpan = document.getElementById("score");
    const livesSpan = document.getElementById("lives");
    const rowHintsP = document.getElementById("rowHints");
    const colHintsP = document.getElementById("colHints");
    const restartBtn = document.getElementById("restartBtn");
    const catIcon = document.getElementById("cuteCat");

    let boxes = [];       // ゲーム盤の状態を格納する2次元配列
    let revealed = [];    // 各マスが開いているかどうか
    let rowHints = [];    // 各行にいる元気なにゃんこの数
    let colHints = [];    // 各列にいる元気なにゃんこの数
    let totalLiveCats = 0; // 全マス中の元気なにゃんこの数
    let foundLiveCats = 0; // プレイヤーが見つけた元気なにゃんこの数
    let score = 0;
    let lives = 3;
    let gameOver = false;

    // --- 猫画像をクリックしたときにポヨンと弾む ---
    catIcon.addEventListener("click", () => {
      // 1. ゆらゆらダンスを一時的に外して…
      catIcon.classList.remove("catDance");
      // 2. ポヨンアニメを付ける
      catIcon.classList.add("poyon");

      // 0.3秒後にポヨンアニメを外して、再びダンスを復帰
      setTimeout(() => {
        catIcon.classList.remove("poyon");
        catIcon.classList.add("catDance");
      }, 300);
    });

    // ゲーム初期化
    function initGame() {
      gameOver = false;
      score = 0;
      lives = 3;
      foundLiveCats = 0;
      scoreSpan.textContent = score;
      livesSpan.textContent = lives;
      restartBtn.style.display = "none";

      boxes = [];
      revealed = [];
      totalLiveCats = 0;

      // 4x4のマスをランダムに配置
      // 例：live(元気):25%, sleep(おやすみ):25%, none(何もなし):50%
      for (let row = 0; row < 4; row++) {
        let rowArr = [];
        let revealArr = [];
        for (let col = 0; col < 4; col++) {
          let rand = Math.random();
          let state;
          if (rand < 0.25) {
            state = "live";
            totalLiveCats++;
          } else if (rand < 0.5) {
            state = "sleep"; // おやすみなにゃんこ
          } else {
            state = "none";  // 何もない
          }
          rowArr.push(state);
          revealArr.push(false);
        }
        boxes.push(rowArr);
        revealed.push(revealArr);
      }

      // 行・列ごとの「元気なにゃんこ」の数をカウント
      rowHints = [0,0,0,0];
      colHints = [0,0,0,0];

      for (let row = 0; row < 4; row++) {
        for (let col = 0; col < 4; col++) {
          if (boxes[row][col] === "live") {
            rowHints[row]++;
            colHints[col]++;
          }
        }
      }

      drawTable();
      rowHintsP.textContent = `行ヒント: [${rowHints.join(" / ")}]`;
      colHintsP.textContent = `列ヒント: [${colHints.join(" / ")}]`;
    }

    // テーブル描画
    function drawTable() {
      table.innerHTML = "";
      for (let row = 0; row < 4; row++) {
        const tr = document.createElement("tr");
        for (let col = 0; col < 4; col++) {
          const td = document.createElement("td");
          td.textContent = revealed[row][col] ? getSymbol(boxes[row][col]) : "❓";
          td.style.cursor = revealed[row][col] || gameOver ? "default" : "pointer";

          // クリックイベント
          td.addEventListener("click", () => {
            if (!gameOver && !revealed[row][col]) {
              revealBox(row, col);
            }
          });
          tr.appendChild(td);
        }
        table.appendChild(tr);
      }
    }

    // マスの状態に応じた絵文字を返す
    function getSymbol(state) {
      switch(state) {
        case "live":  return "🐱"; // 元気なにゃんこ
        case "sleep": return "💤"; // おやすみなにゃんこ
        default:      return "❌"; // 何もない
      }
    }

    // 指定マスを開く処理
    function revealBox(row, col) {
      revealed[row][col] = true;
      const state = boxes[row][col];

      if (state === "live") {
        score++;
        foundLiveCats++;
      } else if (state === "sleep") {
        lives--;
      }

      // スコアやライフを更新
      scoreSpan.textContent = score;
      livesSpan.textContent = lives;

      // 勝敗判定
      if (foundLiveCats === totalLiveCats) {
        endGame(true);
      } else if (lives <= 0) {
        endGame(false);
      }

      drawTable();
    }

    // ゲーム終了処理
    function endGame(isWin) {
      gameOver = true;
      drawTable();
      restartBtn.style.display = "inline-block";
      if (isWin) {
        alert(`元気なにゃんこを全部見つけたにゃ！\nスコア: ${score}`);
      } else {
        alert(`ライフがなくなっちゃったにゃ…\n最終スコア: ${score}`);
      }
    }

    // リスタート
    restartBtn.addEventListener("click", initGame);

    // ページ読み込み時に初期化
    initGame();
  </script>

  <!-- ゲームの説明（下に配置） -->
  <div id="explanation">
    <h2>【ゲーム説明】</h2>
    <p>
      ここは不思議な「シュレディンガーの猫」の世界にゃ。<br>
      4×4マスのどこかに「元気なにゃんこ」と「おやすみなにゃんこ」が隠れてるよ。
    </p>
    <ul>
      <li>元気なにゃんこを開く → <b>スコア+1</b></li>
      <li>おやすみなにゃんこを開く → <b>ライフ-1</b></li>
      <li>何もないマスはセーフ</li>
    </ul>
    <p>
      各行・列のヒント（元気なにゃんこの数）を手がかりに、<br>
      マスをうまく「観測」してにゃん。<br>
      ライフが0になる前に全部の元気なにゃんこを見つけられたらクリアだよ〜！
    </p>
  </div>
</body>
</html>
