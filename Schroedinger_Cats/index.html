<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <!-- ã‚¹ãƒãƒ›ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆå¯¾å¿œ -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚·ãƒ¥ãƒ¬ãƒ‡ã‚£ãƒ³ã‚¬ãƒ¼ãƒ»ã‚­ãƒ£ãƒƒãƒ„</title>
  <style>
    /* --- ãµã‚“ã‚ã‚Šãƒ‘ã‚¹ãƒ†ãƒ«èª¿ã®èƒŒæ™¯ï¼†è»½ã„è£…é£¾ --- */
    body {
      margin: 0;
      padding: 20px;
      font-family: "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif;
      background: linear-gradient(120deg, #ffe2e2 0%, #7ad5ff 100%);
      text-align: center;
    }
    h1 {
      color: #635155;
      text-shadow: 1px 1px 2px #fff;
      margin: 10px 0;
    }
    /* --- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã‚¨ãƒªã‚¢ --- */
    #status {
      margin: 10px auto;
      font-size: 18px;
      max-width: 600px;
      padding: 10px;
      background-color: #fff6f9;
      border-radius: 8px;
      box-shadow: 1px 1px 6px rgba(0,0,0,0.1);
    }
    #status span {
      color: #c64561;
      font-weight: bold;
    }
    /* --- ãƒ’ãƒ³ãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ --- */
    #hints {
      margin: 10px auto;
      max-width: 600px;
      font-size: 16px;
      background-color: #fff;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 1px 1px 6px rgba(0,0,0,0.1);
    }
    #rowHints, #colHints {
      margin: 5px 0;
      color: #635155;
    }
    /* --- ãƒ‘ã‚ºãƒ«ã¨çŒ«ã‚’é…ç½®ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠ --- */
    #puzzleContainer {
      text-align: center;
      margin: 20px auto;
    }
    /* --- çŒ«ç”»åƒ --- */
    #cuteCat {
      width: 120px;        /* çŒ«ç”»åƒã®ã‚µã‚¤ã‚º */
      margin-bottom: 10px;
      cursor: pointer;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    /* --- .catDance ã‚¯ãƒ©ã‚¹ã§ã‚†ã‚‰ã‚†ã‚‰ãƒ€ãƒ³ã‚¹ --- */
    .catDance {
      animation: catDance 2s ease-in-out infinite;
    }
    /* --- ã‚²ãƒ¼ãƒ ç›¤ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ --- */
    table {
      border-collapse: collapse;
      box-shadow: 2px 2px 10px rgba(0,0,0,0.15);
      margin: 0 auto;
    }
    td {
      width: 50px;
      height: 50px;
      border: 2px solid #f9bccd;
      background-color: #fff;
      font-size: 26px;
      text-align: center;
      vertical-align: middle;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.2s;
    }
    td:hover {
      background-color: #ffebf2;
    }
    /* --- ãƒªã‚¹ã‚¿ãƒ¼ãƒˆï¼†é›£æ˜“åº¦åˆ‡æ›¿ãƒœã‚¿ãƒ³ --- */
    #restartBtn, .diffBtn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
      border: none;
      border-radius: 8px;
      background-color: #f4a4bb;
      color: #fff;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.1);
      transition: background-color 0.3s;
    }
    #restartBtn:hover, .diffBtn:hover {
      background-color: #e07e96;
    }
    #diffButtons {
      margin: 20px auto;
    }
    /* --- ã‚†ã‚‰ã‚†ã‚‰ãƒ€ãƒ³ã‚¹ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ --- */
    @keyframes catDance {
      0%   { transform: rotate(0deg) scale(1); }
      25%  { transform: rotate(-5deg) scale(1.2); }
      50%  { transform: rotate(5deg) scale(0.8); }
      75%  { transform: rotate(-5deg) scale(1.1); }
      100% { transform: rotate(0deg) scale(1); }
    }
    /* --- ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ãƒãƒ¨ãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ --- */
    @keyframes catPoyon {
      0%   { transform: scale(1); }
      50%  { transform: scale(1.5); }
      100% { transform: scale(1); }
    }
    .poyon {
      animation: catPoyon 0.3s ease-in-out forwards;
    }
    /* --- èª¬æ˜æ–‡ --- */
    #explanation {
      margin: 30px auto 0;
      max-width: 600px;
      background-color: rgba(255,255,255,0.8);
      border-radius: 8px;
      padding: 15px;
      font-size: 14px;
      color: #444;
      line-height: 1.6;
      box-shadow: 1px 1px 6px rgba(0,0,0,0.1);
      text-align: left;
    }
    #explanation h2 {
      margin-top: 0;
    }
    /* --- ã‚¹ãƒãƒ›å‘ã‘èª¿æ•´ --- */
    @media (max-width: 600px) {
      body { padding: 10px; }
      h1 { font-size: 22px; }
      #status, #hints { font-size: 14px; width: 90%; }
      table td { width: 40px; height: 40px; font-size: 20px; }
      #restartBtn, .diffBtn { font-size: 16px; }
      #explanation { font-size: 12px; width: 90%; }
      #cuteCat { width: 100px; }
    }
  </style>
</head>
<body>
  <h1>ã‚·ãƒ¥ãƒ¬ãƒ‡ã‚£ãƒ³ã‚¬ãƒ¼â¤ï¸ã‚­ãƒ£ãƒƒãƒ„</h1>
  <div id="status">
    ã‚¹ã‚³ã‚¢: <span id="score">0</span> / ãƒ©ã‚¤ãƒ•: <span id="lives">3</span>
  </div>
  <div id="hints">
    <p id="rowHints"></p>
    <p id="colHints"></p>
  </div>
  <!-- ãƒ‘ã‚ºãƒ«ã¨çŒ«ã‚’é…ç½®ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠ -->
  <div id="puzzleContainer">
    <!-- çŒ«ç”»åƒã¯ç›¤é¢ã®çœŸä¸Šã«é…ç½® -->
    <img src="cat.PNG" id="cuteCat" alt="Cute Cat" class="catDance">
    <!-- ã‚²ãƒ¼ãƒ ç›¤ -->
    <table id="gameTable"></table>
  </div>
  <!-- é›£æ˜“åº¦åˆ‡æ›¿ãƒœã‚¿ãƒ³ï¼ˆãƒ‘ã‚ºãƒ«ã®ä¸‹ã«é…ç½®ï¼‰ -->
  <div id="diffButtons">
    <button class="diffBtn" id="btn4x4">4Ã—4ãƒ¢ãƒ¼ãƒ‰</button>
    <button class="diffBtn" id="btn6x6">6Ã—6ãƒ¢ãƒ¼ãƒ‰</button>
  </div>
  <button id="restartBtn" style="display: none;">ã‚‚ã†ã„ã£ã‹ã„ã‚„ã‚‹ã«ã‚ƒ</button>
  <div id="explanation">
    <h2>ã€ã‚²ãƒ¼ãƒ èª¬æ˜ã€‘</h2>
    <p>
      ã“ã“ã¯ä¸æ€è­°ãªã€Œã‚·ãƒ¥ãƒ¬ãƒ‡ã‚£ãƒ³ã‚¬ãƒ¼ã®çŒ«ã€ã®ä¸–ç•Œã«ã‚ƒã€‚<br>
      ãƒã‚¹ã®ã©ã“ã‹ã«ã€Œå…ƒæ°—ãªã«ã‚ƒã‚“ã“ã€ã¨ã€ŒãŠã‚„ã™ã¿ãªã«ã‚ƒã‚“ã“ã€ãŒéš ã‚Œã¦ã‚‹ã«ã‚ƒã€‚
    </p>
    <ul>
      <li>å…ƒæ°—ãªã«ã‚ƒã‚“ã“ã‚’é–‹ã â†’ <b>ã‚¹ã‚³ã‚¢+1</b> ï¼ˆã€Œmeow.wavã€å†ç”Ÿï¼‰</li>
      <li>ãŠã‚„ã™ã¿ãªã«ã‚ƒã‚“ã“ã‚’é–‹ã â†’ <b>ãƒ©ã‚¤ãƒ•-1</b> ï¼ˆã€Œgrgr.wavã€å†ç”Ÿï¼‰</li>
      <li>ä½•ã‚‚ãªã„ãƒã‚¹ã¯ã‚»ãƒ¼ãƒ•</li>
    </ul>
    <p>
      å„è¡Œãƒ»åˆ—ã®ãƒ’ãƒ³ãƒˆã‚’é ¼ã‚Šã«ã€ãƒã‚¹ã‚’ã†ã¾ãã€Œè¦³æ¸¬ã€ã—ã¦ã«ã‚ƒã€‚<br>
      ãƒ©ã‚¤ãƒ•ãŒ0ã«ãªã‚‹å‰ã«ã€å…¨ã¦ã®å…ƒæ°—ãªã«ã‚ƒã‚“ã“ã‚’è¦‹ã¤ã‘ãŸã‚‰ã‚¯ãƒªã‚¢ã ã«ã‚ƒï¼
    </p>
    <a href="cattower.html">ãƒ†ã‚¹ãƒˆ</a>
  </div>
  <script>
    // --- Web Audio API ã‚’åˆ©ç”¨ã—ã¦éŸ³å£°ã‚’å†ç”Ÿã™ã‚‹ ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(url, gainVal) {
      fetch(url)
        .then(response => response.arrayBuffer())
        .then(arrayBuffer => audioCtx.decodeAudioData(arrayBuffer))
        .then(audioBuffer => {
          const source = audioCtx.createBufferSource();
          source.buffer = audioBuffer;
          const gainNode = audioCtx.createGain();
          gainNode.gain.value = gainVal; // gainVal ã‚’ 1 ã«è¨­å®šï¼ˆç­‰å€ï¼‰
          source.connect(gainNode);
          gainNode.connect(audioCtx.destination);
          source.start();
        })
        .catch(e => console.error(e));
    }

    // --- ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨è¦ç´ ã®å–å¾— ---
    let gridSize = 4; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯4x4
    const table = document.getElementById("gameTable");
    const scoreSpan = document.getElementById("score");
    const livesSpan = document.getElementById("lives");
    const rowHintsP = document.getElementById("rowHints");
    const colHintsP = document.getElementById("colHints");
    const restartBtn = document.getElementById("restartBtn");
    const btn4x4 = document.getElementById("btn4x4");
    const btn6x6 = document.getElementById("btn6x6");
    const catIcon = document.getElementById("cuteCat");

    let boxes = [];
    let revealed = [];
    let rowHints = [];
    let colHints = [];
    let totalLiveCats = 0;
    let foundLiveCats = 0;
    let score = 0;
    let lives = 3;
    let gameOver = false;

    // --- é›£æ˜“åº¦åˆ‡æ›¿ãƒœã‚¿ãƒ³ ---
    btn4x4.addEventListener("click", () => { gridSize = 4; initGame(); });
    btn6x6.addEventListener("click", () => { gridSize = 6; initGame(); });

    // --- çŒ«ç”»åƒã‚¯ãƒªãƒƒã‚¯ã§ãƒãƒ¨ãƒ³ï¼†ã€Œmeow.wavã€å†ç”Ÿ ---
    catIcon.addEventListener("click", () => {
      catIcon.classList.remove("catDance");
      catIcon.classList.add("poyon");
      playSound("meow.wav", 1);
      setTimeout(() => {
        catIcon.classList.remove("poyon");
        catIcon.classList.add("catDance");
      }, 300);
    });

    function initGame() {
      gameOver = false;
      score = 0;
      lives = 3;
      foundLiveCats = 0;
      scoreSpan.textContent = score;
      livesSpan.textContent = lives;
      restartBtn.style.display = "none";

      boxes = [];
      revealed = [];
      totalLiveCats = 0;

      let cellSize = gridSize === 4 ? 50 : 40;
      let fontSize = gridSize === 4 ? 26 : 20;

      // ã‚²ãƒ¼ãƒ ç›¤ç”Ÿæˆ
      for (let row = 0; row < gridSize; row++) {
        let rowArr = [];
        let revealArr = [];
        for (let col = 0; col < gridSize; col++) {
          let rand = Math.random();
          let state;
          if (rand < 0.25) {
            state = "live";
            totalLiveCats++;
          } else if (rand < 0.5) {
            state = "sleep";
          } else {
            state = "none";
          }
          rowArr.push(state);
          revealArr.push(false);
        }
        boxes.push(rowArr);
        revealed.push(revealArr);
      }

      // ãƒ’ãƒ³ãƒˆã‚«ã‚¦ãƒ³ãƒˆ
      rowHints = new Array(gridSize).fill(0);
      colHints = new Array(gridSize).fill(0);
      for (let row = 0; row < gridSize; row++) {
        for (let col = 0; col < gridSize; col++) {
          if (boxes[row][col] === "live") {
            rowHints[row]++;
            colHints[col]++;
          }
        }
      }

      drawTable(cellSize, fontSize);
      rowHintsP.textContent = `è¡Œãƒ’ãƒ³ãƒˆ: [${rowHints.join(" / ")}]`;
      colHintsP.textContent = `åˆ—ãƒ’ãƒ³ãƒˆ: [${colHints.join(" / ")}]`;
    }

    function drawTable(cellSize, fontSize) {
      table.innerHTML = "";
      for (let row = 0; row < gridSize; row++) {
        const tr = document.createElement("tr");
        for (let col = 0; col < gridSize; col++) {
          const td = document.createElement("td");
          td.style.width = cellSize + "px";
          td.style.height = cellSize + "px";
          td.style.fontSize = fontSize + "px";
          td.textContent = revealed[row][col] ? getSymbol(boxes[row][col]) : "â“";
          td.style.cursor = revealed[row][col] || gameOver ? "default" : "pointer";
          td.addEventListener("click", () => {
            if (!gameOver && !revealed[row][col]) {
              revealBox(row, col);
            }
          });
          tr.appendChild(td);
        }
        table.appendChild(tr);
      }
    }

    function getSymbol(state) {
      switch(state) {
        case "live":  return "ğŸ±";
        case "sleep": return "ğŸ’¤";
        default:      return "âŒ";
      }
    }

    function revealBox(row, col) {
      revealed[row][col] = true;
      const state = boxes[row][col];
      if (state === "live") {
        score++;
        foundLiveCats++;
        playSound("meow.wav", 1);
      } else if (state === "sleep") {
        lives--;
        playSound("grgr.wav", 1);
      }
      scoreSpan.textContent = score;
      livesSpan.textContent = lives;
      if (foundLiveCats === totalLiveCats) {
        endGame(true);
      } else if (lives <= 0) {
        endGame(false);
      }
      drawTable(gridSize === 4 ? 50 : 40, gridSize === 4 ? 26 : 20);
    }

    function endGame(isWin) {
      gameOver = true;
      drawTable(gridSize === 4 ? 50 : 40, gridSize === 4 ? 26 : 20);
      restartBtn.style.display = "inline-block";
      alert(isWin ? `å…ƒæ°—ãªã«ã‚ƒã‚“ã“ã‚’å…¨éƒ¨è¦‹ã¤ã‘ãŸã«ã‚ƒï¼\nã‚¹ã‚³ã‚¢: ${score}` : `ãƒ©ã‚¤ãƒ•ãŒãªããªã£ã¡ã‚ƒã£ãŸã«ã‚ƒâ€¦\næœ€çµ‚ã‚¹ã‚³ã‚¢: ${score}`);
    }

    restartBtn.addEventListener("click", initGame);
    initGame();
  </script>
</body>
</html>
