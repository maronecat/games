<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Solar System Zoom</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
  </style>
</head>
<body>
<script type="module">
  import * as THREE from 'https://cdn.skypack.dev/three@0.154.0';

  // シーンの作成
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
  const renderer = new THREE.WebGLRenderer();
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // 光源の追加
  const light = new THREE.PointLight(0xffffff, 1, 100);
  light.position.set(0, 0, 0); // 太陽の位置
  scene.add(light);

  // 太陽の作成
  const sunGeometry = new THREE.SphereGeometry(5, 32, 32);
  const sunMaterial = new THREE.MeshBasicMaterial({ color: 0xffcc00 });
  const sun = new THREE.Mesh(sunGeometry, sunMaterial);
  scene.add(sun);

  // 各惑星を追加する関数
  const createPlanet = (size, color, distance) => {
    const geometry = new THREE.SphereGeometry(size, 32, 32);
    const material = new THREE.MeshStandardMaterial({ color });
    const planet = new THREE.Mesh(geometry, material);
    planet.position.x = distance;
    scene.add(planet);
    return planet;
  };

  const planets = [
    createPlanet(0.5, 0x88ccee, 8),  // 水星
    createPlanet(0.9, 0xdfbdbd, 11), // 金星
    createPlanet(1, 0x00aaff, 16),   // 地球
    createPlanet(0.75, 0xee8822, 22),// 火星
    createPlanet(2, 0xffaa00, 40),   // 木星
    createPlanet(1.5, 0xccccff, 60), // 土星
    createPlanet(1.2, 0x88aaff, 80), // 天王星
    createPlanet(1.1, 0x5555ff, 100) // 海王星
  ];

  // カメラの初期位置
  camera.position.z = 50;

  // デバイスのピンチ用
  let startDistance = 0;
  const onPinchStart = (e) => {
    if (e.touches.length === 2) {
      const dx = e.touches[0].pageX - e.touches[1].pageX;
      const dy = e.touches[0].pageY - e.touches[1].pageY;
      startDistance = Math.sqrt(dx * dx + dy * dy);
    }
  };

  const onPinchMove = (e) => {
    if (e.touches.length === 2) {
      const dx = e.touches[0].pageX - e.touches[1].pageX;
      const dy = e.touches[0].pageY - e.touches[1].pageY;
      const newDistance = Math.sqrt(dx * dx + dy * dy);

      // ピンチによるズームイン・アウト
      const zoomFactor = (newDistance - startDistance) * 0.01;
      camera.position.z -= zoomFactor;
      startDistance = newDistance;
    }
  };

  document.addEventListener('touchstart', onPinchStart, false);
  document.addEventListener('touchmove', onPinchMove, false);

  // アニメーションループ
  const animate = () => {
    requestAnimationFrame(animate);
    renderer.render(scene, camera);

    // 回転させる
    sun.rotation.y += 0.002;
    planets.forEach((planet, idx) => {
      planet.rotation.y += 0.01;
      planet.position.x = Math.cos(Date.now() * 0.001 + idx) * (8 + idx * 10);
      planet.position.z = Math.sin(Date.now() * 0.001 + idx) * (8 + idx * 10);
    });
  };
  animate();

  // リサイズ対応
  window.addEventListener('resize', () => {
    const width = window.innerWidth;
    const height = window.innerHeight;
    renderer.setSize(width, height);
    camera.aspect = width / height;
    camera.updateProjectionMatrix();
  });
</script>
</body>
</html>